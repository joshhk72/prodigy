{"version":3,"sources":["./app/assets/images/default-profile.jpg","./frontend/components/track_show/artist_link.jsx","./frontend/components/track_show/comments/column.jsx","./frontend/components/track_show/comments/form.jsx","./frontend/components/track_show/comments/list_item.jsx","./frontend/components/track_show/comments/list_item_container.js","./frontend/components/track_show/questions/answer_body.jsx","./frontend/components/track_show/questions/answered_panel.jsx","./frontend/components/track_show/questions/form.jsx","./frontend/components/track_show/questions/section.jsx","./frontend/components/track_show/questions/unanswered_panel.jsx","./frontend/components/track_show/questions/upvotes.jsx","./frontend/components/track_show/second_column/annotation_body.jsx","./frontend/components/track_show/second_column/annotation_edit_form.jsx","./frontend/components/track_show/second_column/annotation_form.jsx","./frontend/components/track_show/second_column/annotation_show.jsx","./frontend/components/track_show/second_column/annotation_show_container.js","./frontend/components/track_show/second_column/info_column.jsx","./frontend/components/track_show/second_column/info_column_container.js","./frontend/components/track_show/second_column/non_annotation_column.jsx","./frontend/components/track_show/track_show.jsx","./frontend/components/track_show/track_show_container.js","./frontend/util/annotate_util.js","./frontend/util/tweet_util.js","./frontend/util/upvote_util.js"],"names":["TrackArtistLink","props","artist","id","name","CommentColumn","dispatch","useDispatch","comments","useSelector","state","entities","currentUser","users","session","useEffect","clearComments","fetchTrackComments","currentTrack","commentLis","Object","values","map","comment","CommentForm","useState","commenting","setCommenting","body","setBody","author","trackId","area","React","createRef","current","focus","submitComment","e","preventDefault","createComment","author_id","track_id","then","preform","form","target","value","CommentListItem","upvote","bind","downvote","reverseUpvote","deleteUpvote","fetchCommentUpvotes","createUpvote","user_id","upvotable_type","upvotable_id","currentUpvote","username","profile_img","date","deleteComment","upvotes","deleteButton","result","confirm","commentUpvotes","UpvoteUtil","upvoteCount","sign","leftCb","rightCb","leftClass","rightClass","src","defaultProfileImage","Component","mapStateToProps","mapDispatchToProps","commentId","connect","require","AnswerBody","answer","renderTweets","tweetsReplaced","replaceTweets","converter","showdown","Converter","extensions","html","makeHtml","__html","AnsweredPanel","question","updateAnswer","deleteAnswer","currentUserId","editing","setEditing","onceFocused","setOnceFocused","textarea","undefined","autosize","title","node","stopPropagation","QuestionForm","createQuestion","focused","setFocused","setTitle","QuestionSection","questions","setQuestions","partition","q","answeredQuestions","unansweredQuestions","currentQuestions","clearQuestions","fetchTrackQuestions","match","params","res","answeredPanels","unansweredPanels","createAnswer","deleteQuestion","withRouter","UnansweredPanel","question_id","permanent","fetchAnswerUpvotes","answerId","QuestionUpvotes","setLoaded","loaded","handleNothing","delUpvote","revUpvote","answerUpvotes","AnnotationBody","annotationId","ownProps","currentAnnotation","annotations","submit","annotation","updateAnnotation","AnnotationEditForm","top","handleSave","handleCancel","span","document","getElementById","classList","add","remove","history","push","field","setState","lyricsContainer","style","top1","getBoundingClientRect","top2","marginTop","Math","max","placeholdText","update","AnnotationForm","merge","authorId","removeAnnotation","destroyForm","AnnotationShow","fetchAnnotationUpvotes","prevProps","currId","prevId","prevSpan","currSpan","deleteAnnotation","show","Boolean","String","AnnotateUtil","annotationUpvotes","Number","InfoColumn","createAnnotationForm","formNo","forms","prevState","filter","path","split","closeAnnotationPrompt","temp","start_idx","startIdx","end_idx","endIdx","createTempAnnotation","routedForm","createAnnotation","concat","annotationPrompt","isExact","hideNonAnnotation","length","tracks","receiveAnnotation","NonAnnotationColumn","hide","youtube_url","youtubeUrl","regExp","display","handleImageError","TrackShow","done","editLyrics","lyrics","editButton","submitLyrics","handleHighlight","handleSpanClick","handleModal","clearInfo","addEventListener","fetchTrack","track","album_id","fetchAlbum","err","removeEventListener","clearTracks","clearArtists","clearAlbums","clearAnnotations","clearUpvotes","className","localName","x","parentNode","selection","window","getSelection","extentNode","baseNode","annotationNodes","getElementsByClassName","firstColumn","i1","i2","j1","j2","mappedNodeList","childNodes","getRangeAt","showAnnotationPrompt","openModal","defaultImage","updateTrack","loggedIn","lyricsLines","reduce","acc","val","i","lyricsHTML","sort","a","b","annotatedLyrics","editArea","minHeight","height","lyricsButtons","features","producers","writers","album","image_url","featureLinks","feature","producerLinks","producer","writerLinks","writer","heroStyle","backgroundImage","modal","annotationsNotSelected","some","containsNode","annotateLyrics","annotated","forEach","splice","join","lineBreakLyrics","lyricsStr","mapNodeList","nodeList","Array","from","nodeName","innerText","nodeValue","getIndices","container","prototype","indexOf","call","baseOffset","extentOffset","parentElement","getStartAndEndIndices","indices","prevOne","mappedNode","slice","prevTwo","oneIndex","twoIndex","min","displayHeightStyle","tweetRegex","str","replace","tweets","querySelectorAll","tweet","ReactDOM","render","determineSign","count","isUpvotedByUser","isUpvoted","find","determineCallbacks","up","down","erase","reverse","determineClasses"],"mappings":"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","file":"1.bundle.js","sourcesContent":["export default \"/assets/webpack-assets/default-profiled4b454201d8e5d578fc43e61426e1fab.jpg\";","import React from 'react';\nimport { Link } from 'react-router-dom';\n\nconst TrackArtistLink = props => {\n  return (\n    <Link to={`/artists/${props.artist.id}`}>\n      {props.artist.name}\n    </Link>\n  )\n};\n\nexport default TrackArtistLink;","import React, { useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { fetchTrackComments, clearComments } from '../../../actions/comment_actions';\nimport CommentListItemContainer from './list_item_container';\nimport CommentForm from './form';\n\nconst CommentColumn = props => {\n  const dispatch = useDispatch();\n  const comments = useSelector(state => state.entities.comments);\n  const currentUser = useSelector(state => state.entities.users[state.session.id]);\n\n  useEffect(() => {\n    dispatch(clearComments());\n    dispatch(fetchTrackComments(props.currentTrack.id));\n  }, [])\n\n  const commentLis = Object.values(comments).map(comment => {\n    return <CommentListItemContainer \n      comment={comment}\n      key={comment.id} />\n  });\n\n  return (\n    <div className=\"comments-column\">\n      { currentUser && <CommentForm \n        trackId={props.currentTrack.id}\n        author={currentUser}\n      /> }\n      <ul className=\"comments-list\">\n        {commentLis}\n      </ul>\n    </div>\n  )\n};\n\nexport default CommentColumn;","import React, { useState, useEffect } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { createComment } from '../../../actions/comment_actions';\n\nconst CommentForm = props => {\n  const [commenting, setCommenting] = useState(false);\n  const [body, setBody] = useState(\"\");\n  const { author, trackId } = props;\n  const dispatch = useDispatch();\n  const area = React.createRef();\n\n  useEffect(() => {\n    if (area.current) area.current.focus();\n  },[commenting])\n\n  const submitComment = e => {\n    e.preventDefault();\n    dispatch(createComment({ body, author_id: author.id, track_id: trackId }))\n      .then(() => setBody(''));\n  }\n\n  const preform = (\n    <div className=\"comment-form-container\">\n      <input\n        placeholder=\"Add a comment\"\n        className=\"comment-pre\" \n        type=\"text\"\n        onMouseDown={() => {\n          setCommenting(true);\n          setBody('');\n        }} />\n    </div>\n  )\n\n  const form = (\n    <div className=\"comment-form-container\">\n      <form onSubmit={submitComment}>\n        <textarea\n          placeholder=\"Add a comment\"\n          className=\"comment-input\"\n          onChange={e => setBody(e.target.value)}\n          ref={area}\n          value={body} />\n        <button>Submit</button>\n      </form>\n    </div>\n  );\n\n  return commenting ? form : preform\n}\n\nexport default CommentForm;","import React from 'react';\nimport * as UpvoteUtil from '../../../util/upvote_util';\nimport defaultProfileImage from 'assets/images/default-profile.jpg';\n\nclass CommentListItem extends React.Component {\n  constructor(props) {\n    super(props);\n    this.upvote = this.upvote.bind(this);\n    this.downvote = this.downvote.bind(this);\n    this.reverseUpvote = this.reverseUpvote.bind(this);\n    this.deleteUpvote = this.deleteUpvote.bind(this);\n  }\n\n  componentDidMount() {\n    this.props.fetchCommentUpvotes(this.props.comment.id);\n  }\n\n  upvote() {\n    const { id } = this.props.comment;\n    const { currentUser } = this.props;\n    this.props.createUpvote({value: 1, user_id: currentUser.id, upvotable_type: \"Comment\", upvotable_id: id });\n  }\n\n  downvote() {\n    const { id } = this.props.comment;\n    const { currentUser } = this.props;\n    this.props.createUpvote({ value: -1, user_id: currentUser.id, upvotable_type: \"Comment\", upvotable_id: id });\n  }\n\n  reverseUpvote() {\n    this.props.reverseUpvote(this.currentUpvote.id);\n  }\n\n  deleteUpvote() {\n    this.props.deleteUpvote(this.currentUpvote.id);\n  }\n\n  render() {\n    const { username, body, profile_img, date, id, author_id } = this.props.comment\n    const { currentUser, deleteComment, upvotes } = this.props;\n\n    const deleteButton = currentUser && currentUser.id === author_id ? \n      <a onClick={() => { const result = confirm(\"Delete this comment?\"); if (result) deleteComment(id) } }>\n        <i className=\"fas fa-trash-alt\" /></a> \n      : <div></div>;\n\n    // For handling upvotes. This is streamlined since upvotes are implemented\n    // for many things across Prodigy (and also Genius). \n    const commentUpvotes = UpvoteUtil.commentUpvotes(upvotes, id);\n    const upvoteCount = UpvoteUtil.count(commentUpvotes);\n    const sign = UpvoteUtil.determineSign(upvoteCount);\n    this.currentUpvote = UpvoteUtil.currentUpvote(commentUpvotes, currentUser);\n    const [leftCb, rightCb] = UpvoteUtil.determineCallbacks(this.currentUpvote, currentUser, this.upvote, this.downvote, this.deleteUpvote, this.reverseUpvote);\n    const [leftClass, rightClass] = UpvoteUtil.determineClasses(this.currentUpvote);\n\n    return (\n      <li>\n        <div className=\"comment-container\">\n          <div className=\"comment-meta-row\">\n            <div className=\"comment-user-meta\">\n              <img className=\"comment-profile-img\" \n                onError={function () { this.src = defaultProfileImage}}\n                src={profile_img || defaultProfileImage}\n              />\n              <span>{username}</span>\n            </div>\n            <span className=\"comment-date\">{date}</span>\n          </div>\n          <p className=\"comment-body\">{body}</p>\n          <div className=\"comment-bottom\">\n            <div>\n              <a onClick={leftCb} className=\"upvote-link\"><i className={`far fa-thumbs-up ${leftClass}`} /></a>\n              <span className=\"upvote-count\">{sign}{upvoteCount}</span>\n              <a onClick={rightCb} className=\"upvote-link\"><i className={`far fa-thumbs-down fa-flip-horizontal ${rightClass}`} /></a>\n            </div>\n            { deleteButton }\n          </div>\n        </div>\n      </li>\n    )\n  }\n}\n\nexport default CommentListItem;","import { connect } from 'react-redux';\nimport CommentListItem from './list_item';\nimport { deleteComment } from '../../../actions/comment_actions';\nimport { createUpvote, reverseUpvote, deleteUpvote, fetchCommentUpvotes, clearUpvotes } from '../../../actions/upvote_actions';\n\nconst mapStateToProps = state => ({\n  currentUser: state.entities.users[state.session.id],\n  upvotes: Object.values(state.entities.upvotes)\n});\n\nconst mapDispatchToProps = dispatch => ({\n  deleteComment: id => dispatch(deleteComment(id)),\n  createUpvote: upvote => dispatch(createUpvote(upvote)),\n  reverseUpvote: id => dispatch(reverseUpvote(id)),\n  deleteUpvote: id => dispatch(deleteUpvote(id)),\n  fetchCommentUpvotes: commentId => dispatch(fetchCommentUpvotes(commentId))\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(CommentListItem);","import React, { useEffect } from 'react';\nimport showdown from 'showdown';\nimport { replaceTweets, renderTweets } from '../../../util/tweet_util';\nrequire(\"showdown-youtube\");\n\nconst AnswerBody = props => {\n  const { answer } = props;\n  useEffect(() => {\n    renderTweets();\n  }, []);\n  const tweetsReplaced = replaceTweets(answer.body);\n  const converter = new showdown.Converter({ extensions: ['youtube'] });\n  const html = converter.makeHtml(tweetsReplaced);\n  // don't need to sanitize html because it's only on the client side\n  return (\n    <div className=\"answer-body\" dangerouslySetInnerHTML={{__html: html}}>\n    </div>\n  )\n};\n\nexport default AnswerBody;\n","import React, { useState, useEffect } from 'react';\nimport QuestionUpvotes from './upvotes';\nimport AnswerBody from './answer_body';\nimport autosize from 'autosize';\n\nconst AnsweredPanel = props => {\n  const { question, updateAnswer, deleteAnswer, currentUserId } = props;\n  const [editing, setEditing] = useState(false);\n  const [onceFocused, setOnceFocused] = useState(false);\n  const [body, setBody] = useState(question.answer.body);\n  let textarea;\n  useEffect(() => {\n    if (textarea !== undefined && !onceFocused) {\n      textarea.focus();\n      autosize(textarea);\n      setOnceFocused(true);\n    }\n  });\n\n  return (\n    <li className=\"answered-panel\">\n      { !editing && \n        <div className=\"answered-panel-show\">\n          <h4>{question.title}</h4>\n          <AnswerBody answer={ question.answer } />\n          { currentUserId && <div className=\"answered-panel-bottom\">\n            <QuestionUpvotes answerId={question.answer.id}/> \n            <div>\n              <button onClick={() => { const result = confirm(\"Delete answer?\"); \n                if(result) deleteAnswer(question.answer.id) } }>\n                  <i className=\"far fa-trash-alt\"/></button>\n            <button onClick={() => setEditing(true)}><i className=\"fas fa-pencil-alt\" /></button>\n            </div>\n          </div> }\n        </div>\n      }\n      { editing && \n        <form onSubmit={e => {\n          e.preventDefault();\n          updateAnswer({ body, id: question.answer.id })\n            .then(() => { setEditing(false); setOnceFocused(false) });\n        }}>\n            <textarea\n              onChange={e => setBody(e.target.value)}\n              value={body}\n              ref={node => textarea = node}\n              required={true}\n              placeholder=\"Answer here\" />\n            <div className=\"answer-buttons\">\n              <button className=\"question-submit\">Submit</button>\n              <button\n                className=\"question-cancel\"\n                onClick={e => { e.stopPropagation(); setEditing(false); setOnceFocused(false) }}>\n                Cancel</button>\n            </div>\n        </form>\n      }\n    </li>\n  )\n};\n\nexport default AnsweredPanel;","import React, { useState, useEffect } from 'react';\nimport autosize from 'autosize';\n\nconst QuestionForm = props => {\n  const { createQuestion, trackId } = props;\n  let textarea;\n  const [focused, setFocused] = useState(false);\n  const [onceFocused, setOnceFocused] = useState(false);\n  const [title, setTitle] = useState('');\n  useEffect(() => {\n    if (textarea !== undefined && !onceFocused) {\n      textarea.focus();\n      autosize(textarea);\n      setOnceFocused(true);\n    }\n  });\n\n  return (\n    <form \n      className=\"question-form\"\n      onSubmit={ e => {\n        e.preventDefault();\n        createQuestion({ title, track_id: trackId })\n          .then(() => {\n            setTitle('');\n            setFocused(false);\n            setOnceFocused(false);\n          })\n      }}>\n      <label>Ask us a question about this song</label>\n      { focused ?\n        <textarea\n          onChange={e => setTitle(e.target.value)}\n          value={title}\n          required={true}\n          ref={node => textarea = node} \n          placeholder=\"Ask a question\" /> :\n        <input \n          type=\"text\" \n          placeholder=\"Ask a question\" \n          onFocus={() => setFocused(true)} />\n      }\n      {focused && \n        <div className=\"question-buttons\">\n          <button className=\"question-submit\">Submit</button>\n          <button \n            className=\"question-cancel\" \n            onClick={() => { setFocused(false); setOnceFocused(false) } }>Cancel</button>\n        </div>\n      }\n    </form>\n  )\n};\n\nexport default QuestionForm;","import React, { useState, useEffect } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport QuestionForm from './form';\nimport AnsweredPanel from './answered_panel';\nimport UnansweredPanel from './unanswered_panel';\nimport { Link, withRouter } from 'react-router-dom';\nimport { partition } from 'lodash';\nimport { \n  clearQuestions, \n  createQuestion, \n  deleteQuestion, \n  fetchTrackQuestions \n} from '../../../actions/question_actions';\nimport { \n  createAnswer, \n  deleteAnswer, \n  updateAnswer \n} from '../../../actions/answer_actions';\n\nconst QuestionSection = props => {\n  const [questions, setQuestions] = useState([]);\n  const [answeredQuestions, unansweredQuestions] = partition(questions, q => q.answer);\n  const dispatch = useDispatch();\n  const currentQuestions = useSelector(state => state.entities.questions);\n  const currentUserId = useSelector(state => state.session.id);\n  \n  useEffect(() => {\n    dispatch(clearQuestions());\n    dispatch(fetchTrackQuestions(props.match.params.trackId))\n      .then(res => setQuestions(res.questions));\n  }, []);\n\n  useEffect(() => {\n    setQuestions(currentQuestions);\n  }, [currentQuestions]);\n  \n  const answeredPanels = answeredQuestions.map(q => \n    <AnsweredPanel key={q.id}\n      question={q}\n      updateAnswer={answer => dispatch(updateAnswer(answer))}\n      deleteAnswer={id => dispatch(deleteAnswer(id))} \n      currentUserId={currentUserId}/>);\n  const unansweredPanels = unansweredQuestions.map(q => \n    <UnansweredPanel key={q.id} \n      question={q} \n      createAnswer={answer => dispatch(createAnswer(answer))} \n      deleteQuestion={id => dispatch(deleteQuestion(id))} />);\n\n  return (\n    <div className=\"question-section\">\n      <ul className=\"answered-questions-list\">\n        { answeredPanels }\n      </ul>\n      { currentUserId && <ul className=\"unanswered-questions-list\">\n        { unansweredPanels }\n      </ul> }\n      { currentUserId && \n        <QuestionForm \n          createQuestion={question => dispatch(createQuestion(question))} \n          trackId={props.match.params.trackId} \n        /> \n      }\n      { currentUserId && \n        <p className=\"question-info\">\n          Annotations and answers for questions use the <a target=\"_blank\" href=\"http://demo.showdownjs.com/\">Showdown </a> Markdown converter library!\n          Also check out the <Link to=\"/format\" target=\"_blank\">formatting help page</Link>.\n        </p>\n      }\n    </div>\n  )\n};\n\nexport default withRouter(QuestionSection);","import React, { useState, useEffect } from 'react';\nimport autosize from 'autosize';\n\nconst UnansweredPanel = props => {\n  const { question, createAnswer, deleteQuestion } = props;\n  const [focused, setFocused] = useState(false);\n  const [onceFocused, setOnceFocused] = useState(false);\n  const [body, setBody] = useState('');\n  let textarea;\n  useEffect(() => {\n    if (textarea !== undefined && !onceFocused) {\n      textarea.focus();\n      autosize(textarea);\n      setOnceFocused(true);\n    }\n  });\n\n  return (\n    <li className=\"unanswered-panel\">\n      {!focused && <h4>{question.title}</h4> }\n      <form onSubmit={ e => {\n        e.preventDefault();\n        createAnswer({ body, question_id: question.id })\n          .then(() => { setBody(''); setFocused(false); setOnceFocused(false) });\n      } }>\n      {focused ?\n        <textarea\n          onChange={ e => setBody(e.target.value) }\n          value={body}\n          required={true}\n          ref={node => textarea = node}\n          placeholder={`${question.title}`} /> :\n        <input\n          type=\"text\"\n          placeholder=\"Answer here\"\n          onFocus={() => setFocused(true)} />\n      }\n        {focused &&\n          <div className=\"question-buttons\">\n            <button className=\"question-submit\">Submit</button>\n            <button \n              className=\"question-cancel\" \n              onClick={ e => { e.stopPropagation(); setFocused(false); setOnceFocused(false) } }>\n                Cancel</button>\n            { !question.permanent && <button \n              className=\"question-delete\" \n              onClick={e => { e.stopPropagation(); e.preventDefault(); const result = confirm(\"Delete question?\"); if(result) deleteQuestion(question.id) } }>\n              Delete</button> }\n          </div>\n        }\n      </form>\n    </li>\n  )\n};\n\nexport default UnansweredPanel;","import React, { useEffect, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { fetchAnswerUpvotes, createUpvote, deleteUpvote, reverseUpvote } from '../../../actions/upvote_actions';\nimport * as UpvoteUtil from '../../../util/upvote_util';\n\nconst mapStateToProps = state => ({\n  currentUser: state.entities.users[state.session.id],\n  upvotes: Object.values(state.entities.upvotes)\n});\n\nconst mapDispatchToProps = dispatch => ({\n  createUpvote: upvote => dispatch(createUpvote(upvote)),\n  reverseUpvote: id => dispatch(reverseUpvote(id)),\n  deleteUpvote: id => dispatch(deleteUpvote(id)),\n  fetchAnswerUpvotes: answerId => dispatch(fetchAnswerUpvotes(answerId))\n});\n\nconst QuestionUpvotes = props => {\n  const { upvotes, currentUser, answerId, createUpvote, reverseUpvote, deleteUpvote, fetchAnswerUpvotes } = props;\n  useEffect(() => {\n    fetchAnswerUpvotes(answerId)\n      .then(() => setLoaded(true));\n  }, [])\n  const [loaded, setLoaded] = useState(false);\n  if (!loaded) return null;\n\n  const handleNothing = () => {};\n  const upvote = () => createUpvote({ value: 1, user_id: currentUser.id, upvotable_type: \"Answer\", upvotable_id: answerId });\n  const downvote = () => createUpvote({ value: -1, user_id: currentUser.id, upvotable_type: \"Answer\", upvotable_id: answerId });\n  const delUpvote = () => deleteUpvote(currentUpvote.id);\n  const revUpvote = () => reverseUpvote(currentUpvote.id);\n  // For handling upvotes. This is streamlined since upvotes are implemented\n  // for many things across Prodigy (and also Genius).\n\n  const answerUpvotes = UpvoteUtil.answerUpvotes(upvotes, answerId);\n  const upvoteCount = UpvoteUtil.count(answerUpvotes);\n  const sign = UpvoteUtil.determineSign(upvoteCount);\n  const currentUpvote = UpvoteUtil.currentUpvote(answerUpvotes, currentUser);\n  const [leftCb, rightCb] = UpvoteUtil.determineCallbacks(currentUpvote, currentUser, upvote, downvote, delUpvote, revUpvote, handleNothing);\n  const [leftClass, rightClass] = UpvoteUtil.determineClasses(currentUpvote);\n\n  return (\n    <div className=\"answer-upvotes\">\n      <a onClick={leftCb} className=\"upvote-link\"><i className={`far fa-thumbs-up ${leftClass}`} /></a>\n      <span className=\"upvote-count\">{sign}{upvoteCount}</span>\n      <a onClick={rightCb} className=\"upvote-link\"><i className={`far fa-thumbs-down fa-flip-horizontal ${rightClass}`} /></a>\n    </div>\n  )\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(QuestionUpvotes);","import React, { useEffect } from 'react';\nimport showdown from 'showdown';\nimport { replaceTweets, renderTweets } from '../../../util/tweet_util';\nimport { withRouter } from 'react-router-dom';\nrequire(\"showdown-youtube\");\n\nconst AnnotationBody = props => {\n  const { body } = props;\n  useEffect(() => {\n    renderTweets();\n  }, [props.match.params.annotationId]);\n  const tweetsReplaced = replaceTweets(body);\n  const converter = new showdown.Converter({ extensions: ['youtube'] });\n  const html = converter.makeHtml(tweetsReplaced);\n\n  // don't need to sanitize html because it's only on the client side\n  return (\n    <div className=\"annotation-body annotation-show\" dangerouslySetInnerHTML={{ __html: html }}>\n    </div>\n  )\n};\n\nexport default withRouter(AnnotationBody);","import React from 'react';\nimport autosize from 'autosize';\nimport { updateAnnotation } from '../../../actions/annotation_actions';\nimport { connect } from 'react-redux';\nimport { withRouter, Redirect } from 'react-router-dom';\n\nconst mapStateToProps = (state, ownProps) => ({\n  currentUser: state.entities.users[state.session.id],\n  currentAnnotation: state.entities.annotations[ownProps.match.params.annotationId]\n});\n\nconst mapDispatchToProps = dispatch => ({\n  submit: annotation => dispatch(updateAnnotation(annotation))\n});\n\nclass AnnotationEditForm extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = this.props.currentAnnotation;\n    this.top = this.props.top;\n    this.handleSave = this.handleSave.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n    this.textarea = React.createRef();\n  }\n\n  componentDidMount() {\n    const span = document.getElementById(this.state.id);\n    if (span) { span.classList.add(\"active-annotation\") };\n    autosize(this.textarea.current);\n  }\n\n  componentWillUnmount() {\n    const span = document.getElementById(this.state.id);\n    if (span) { span.classList.remove(\"active-annotation\") };\n  }\n\n  handleCancel(e) {\n    e.preventDefault();\n    this.props.history.push(`/tracks/${this.state.track_id}/${this.state.id}`);\n  }\n\n  handleSave(e) {\n    e.preventDefault();\n    this.props.submit(this.state)\n      .then(() => {\n        this.props.history.push(`/tracks/${this.state.track_id}/${this.state.id}`);\n      });\n  }\n\n  update(field) {\n    return e => {\n      this.setState({ [field]: e.target.value })\n    };\n  }\n\n  render() {\n    const { currentUser, currentAnnotation } = this.props;\n    if (!currentUser || currentUser.id !== currentAnnotation.author_id) {\n      return <Redirect to={`/tracks/${currentAnnotation.track_id}/${currentAnnotation.id}`}/>\n    }\n\n    const span = document.getElementById(this.state.id);\n    const lyricsContainer = document.getElementById(\"lyrics-rect\");\n\n    let style;\n    if (span) {\n      const top1 = lyricsContainer.getBoundingClientRect().top;\n      const top2 = span.getBoundingClientRect().top;\n      style = { marginTop: `${Math.max(top2 - top1 - 50, 0)}px` };\n    } else {\n      style = { marginTop: `${this.top - 50}px` };\n    }\n    const placeholdText = \"Don't just put the lyric in your own words-drop some knowledge!\";\n    return (\n      <div style={style} className=\"annotation-form-container annotation-submit annotation-show\">\n        <form className=\"annotation-form annotation-submit\" >\n          <textarea ref={this.textarea} className=\"annotation-submit\" placeholder={placeholdText} onChange={this.update(\"body\")} value={this.state.body} />\n          <button className=\"save-annotation\" onClick={this.handleSave}>Save</button>\n          <button className=\"cancel-annotation\" onClick={this.handleCancel}>Cancel</button>\n        </form>\n      </div>\n    )\n  }\n};\n\nexport default withRouter(connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(AnnotationEditForm));","import React from 'react';\nimport autosize from 'autosize';\nimport { merge } from 'lodash';\n\nclass AnnotationForm extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = merge({}, this.props.annotation, { author_id: this.props.authorId });\n    this.top = this.props.top;\n    this.handleCancel = this.handleCancel.bind(this);\n    this.handleSave = this.handleSave.bind(this);\n    this.textarea = React.createRef();\n  }\n\n  componentDidMount() {\n    autosize(this.textarea.current);\n  }\n\n  handleCancel(e) {\n    e.preventDefault();\n    this.props.removeAnnotation(this.state.id);\n    this.props.destroyForm(this.state.id);\n    this.props.history.push(`/tracks/${this.props.match.params.trackId}`);\n  }\n\n  handleSave(e) {\n    e.preventDefault();\n    this.props.submit(this.state)\n      .then((res) => {\n        this.props.removeAnnotation(this.state.id);\n        this.props.destroyForm(this.state.id);\n        this.props.history.push(`/tracks/${this.props.match.params.trackId}/${res.annotation.id}`)\n      });\n  }\n\n  update(field) {\n    return e => {\n      this.setState({ [field]: e.target.value })\n    };\n  }\n\n  render() {\n    const span = document.getElementById(this.state.id);\n    const lyricsContainer = document.getElementById(\"lyrics-rect\");\n\n    let style;\n    if (span) {\n      const top1 = lyricsContainer.getBoundingClientRect().top;\n      const top2 = span.getBoundingClientRect().top;\n      style = { marginTop: `${Math.max(top2 - top1 - 50, 0)}px` };\n    } else {\n      style = { marginTop: `${this.top - 50}px` };\n    }\n    const placeholdText = \"Don't just put the lyric in your own words-drop some knowledge!\";\n    return (\n      <div style={style} className=\"annotation-form-container annotation-submit\">\n        <form className=\"annotation-form annotation-submit\" >\n          <textarea ref={this.textarea} className=\"annotation-submit\" placeholder={placeholdText} onChange={this.update(\"body\")} value={this.state.body} />\n          <button className=\"save-annotation\" onClick={this.handleSave}>Save</button>\n          <button className=\"cancel-annotation\" onClick={this.handleCancel}>Cancel</button>\n        </form>\n      </div>\n    )\n  }\n};\n\nexport default AnnotationForm;\n","import React from 'react';\nimport AnnotationBody from './annotation_body';\nimport { Link } from 'react-router-dom';\nimport * as AnnotateUtil from '../../../util/annotate_util';\nimport * as UpvoteUtil from '../../../util/upvote_util';\n\nclass AnnotationShow extends React.Component {\n  constructor(props) {\n    super(props);\n    this.deleteButton = this.deleteButton.bind(this);\n    this.upvote = this.upvote.bind(this);\n    this.downvote = this.downvote.bind(this);\n    this.reverseUpvote = this.reverseUpvote.bind(this);\n    this.deleteUpvote = this.deleteUpvote.bind(this);\n  }\n\n  componentDidMount() {\n    const { annotationId } = this.props.match.params;\n    if (annotationId[0] !== 't') this.props.fetchAnnotationUpvotes(this.props.match.params.annotationId);\n    const span = document.getElementById(this.props.match.params.annotationId);\n    if (span) { span.classList.add(\"active-annotation\") };\n  }\n\n  componentWillUnmount() {\n    const span = document.getElementById(this.props.match.params.annotationId);\n    if (span) { span.classList.remove(\"active-annotation\") };\n  }\n\n  componentDidUpdate(prevProps) {\n    const currId = this.props.match.params.annotationId;\n    const prevId = prevProps.match.params.annotationId;\n    if (currId !== prevId) {\n      const prevSpan = document.getElementById(prevId);\n      const currSpan = document.getElementById(currId);\n      if (prevSpan) { prevSpan.classList.remove(\"active-annotation\") };\n      if (currSpan) { currSpan.classList.add(\"active-annotation\") };\n    }\n  }\n\n  deleteButton() {\n    if (confirm(\"Delete this annotation?\")) {\n      const annotationId = this.props.match.params.annotationId;\n      this.props.deleteAnnotation(annotationId)\n        .then(() => this.props.history.push(`/tracks/${this.props.match.params.trackId}`));\n    }\n  }\n\n  upvote(e) {\n    e.preventDefault();\n    const { id } = this.props.annotation;\n    const { currentUser } = this.props;\n    this.props.createUpvote({ value: 1, user_id: currentUser.id, upvotable_type: \"Annotation\", upvotable_id: id });\n  }\n\n  downvote(e) {\n    e.preventDefault();\n    const { id } = this.props.annotation;\n    const { currentUser } = this.props;\n    this.props.createUpvote({ value: -1, user_id: currentUser.id, upvotable_type: \"Annotation\", upvotable_id: id });\n  }\n\n  reverseUpvote(e) {\n    e.preventDefault();\n    this.props.reverseUpvote(this.currentUpvote.id);\n  }\n\n  deleteUpvote(e) {\n    e.preventDefault();\n    this.props.deleteUpvote(this.currentUpvote.id);\n  }\n\n  handleNothing(e) {\n    e.preventDefault();\n  }\n\n  render() {\n    const { currentUser, upvotes } = this.props;\n    const currentAnnotation = this.props.annotation;\n    const show = Boolean(currentAnnotation && String(currentAnnotation.id).match(/^[0-9]/));\n    const style = AnnotateUtil.displayHeightStyle(this.props.match.params.annotationId, this.props.top);\n\n    const annotationUpvotes = UpvoteUtil.annotationUpvotes(upvotes, Number(this.props.match.params.annotationId));\n    const upvoteCount = UpvoteUtil.count(annotationUpvotes);\n    const sign = UpvoteUtil.determineSign(upvoteCount);\n    this.currentUpvote = UpvoteUtil.currentUpvote(annotationUpvotes, currentUser);\n    const [leftCb, rightCb] = UpvoteUtil.determineCallbacks(this.currentUpvote, currentUser, this.upvote, this.downvote, this.deleteUpvote, this.reverseUpvote, this.handleNothing);\n    const [leftClass, rightClass] = UpvoteUtil.determineClasses(this.currentUpvote);\n\n    return show ? \n      (<div className=\"annotation-show-container annotation-show\" style={style}>\n        <h3 className=\"annotation-show\">Prodigy Annotation</h3>\n        <div className=\"annotation-show\"><AnnotationBody body={currentAnnotation.body}/></div>\n        <div className=\"annotation-show-bottom annotation-show\">\n          <div className=\"annotation-show-upvotes annotation-show\">\n            <a className=\"upvote-link\" onClick={leftCb}><i className={`far fa-thumbs-up ${leftClass} annotation-show`} /></a>\n            <span className=\"upvote-count annotation-show\">{sign}{upvoteCount}</span>\n            <a className=\"upvote-link\" onClick={rightCb}><i className={`far fa-thumbs-down fa-flip-horizontal ${rightClass} annotation-show`} /></a>\n          </div>\n          <div className=\"annotation-show-buttons annotation-show\">\n            {this.props.currentUserId === currentAnnotation.author_id &&\n              <button\n                className=\"annotation-delete annotation-show\"\n                onClick={this.deleteButton}\n              >Delete</button>}\n            {this.props.currentUserId === currentAnnotation.author_id &&\n              <Link\n                className=\"annotation-edit annotation-show\"\n                to={`/tracks/${currentAnnotation.track_id}/${currentAnnotation.id}/edit`}\n              >Edit</Link>}\n          </div>\n        </div>\n      </div>\n      ) : (<div></div>)\n  }\n};\n\nexport default AnnotationShow;","import { connect } from 'react-redux';\nimport { createUpvote, reverseUpvote, deleteUpvote, fetchAnnotationUpvotes, clearUpvotes } from '../../../actions/upvote_actions';\nimport AnnotationShow from './annotation_show';\n\nconst mapStateToProps = (state, ownProps) => ({\n  currentUser: state.entities.users[state.session.id],\n  upvotes: Object.values(state.entities.upvotes),\n  annotation: state.entities.annotations[ownProps.match.params.annotationId]\n});\n\nconst mapDispatchToProps = dispatch => ({\n  createUpvote: upvote => dispatch(createUpvote(upvote)),\n  reverseUpvote: id => dispatch(reverseUpvote(id)),\n  deleteUpvote: id => dispatch(deleteUpvote(id)),\n  fetchAnnotationUpvotes: annotationId => dispatch(fetchAnnotationUpvotes(annotationId)),\n});\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(AnnotationShow);","import React from 'react';\nimport AnnotationShowContainer from './annotation_show_container';\nimport AnnotationForm from './annotation_form';\nimport AnnotationEditForm from './annotation_edit_form';\nimport { Route, Link } from 'react-router-dom';\nimport NonAnnotationColumn from './non_annotation_column';\n\nclass InfoColumn extends React.Component {\n  constructor(props) {\n    super(props);\n    this.createAnnotationForm = this.createAnnotationForm.bind(this);\n    this.state = { formNo: 0, forms: [] };\n    this.destroyForm = this.destroyForm.bind(this);\n  }\n\n  destroyForm(id) {\n    this.setState(prevState => {\n      const forms = prevState.forms.filter(form => form.props.path.split('/')[3] !== id);\n      return {\n        forms\n      }\n    });\n  }\n\n  createAnnotationForm() {\n    this.props.closeAnnotationPrompt();\n\n    // Create form\n    const temp = { id: `temp-${this.state.formNo}`, start_idx: this.props.startIdx, end_idx: this.props.endIdx, body: \"\", track_id: this.props.currentTrack.id };\n    this.props.createTempAnnotation(temp);\n\n    const routedForm = <Route\n      path={`/tracks/:trackId/${temp.id}`}\n      key={temp.id}\n      render={props => <AnnotationForm {...props}\n        removeAnnotation={this.props.removeAnnotation}\n        submit={this.props.createAnnotation}\n        destroyForm={this.destroyForm}\n        top={this.props.top}\n        authorId={this.props.currentUserId}\n        annotation={temp} />\n      } />\n\n    this.setState(prevState => ({\n      formNo: prevState.formNo + 1,\n      forms: prevState.forms.concat([routedForm])\n    }));\n    this.props.history.push(`/tracks/${this.props.currentTrack.id}/${temp.id}`);\n  }\n\n  render() {\n    const { annotations, annotationPrompt, \n      currentTrack, currentUserId, \n      deleteAnnotation, top, match: { isExact } } = this.props;\n    const style = { marginTop: `${this.props.top}px` };\n    const hideNonAnnotation = annotationPrompt || !isExact;\n    return (\n      <div id=\"info-column\">\n        { currentUserId && annotationPrompt &&\n          <div style={style} className=\"annotation-prompt-container\">\n            <button id=\"annotation-prompt-button\"\n              onClick={this.createAnnotationForm}>Start the Prodigy Annotation\n          </button>\n          </div>}\n        {!currentUserId && annotationPrompt &&\n          <div style={style} className=\"annotation-prompt-container\">\n            <Link id=\"annotation-prompt-button\"\n              to=\"/login\">You must log in to annotate lyrics!\n          </Link>\n          </div>}\n        { !annotationPrompt && this.state.forms.length > 0 && this.state.forms }\n        { !annotationPrompt && \n          <Route exact path=\"/tracks/:trackId/:annotationId\" \n            render={props => <AnnotationShowContainer {...props}\n              annotations={annotations}\n              top={top}\n              currentUserId={currentUserId}\n              deleteAnnotation={deleteAnnotation}\n            />}\n        /> }\n        {!annotationPrompt &&\n          <Route exact path=\"/tracks/:trackId/:annotationId/edit\"\n            render={props => <AnnotationEditForm {...props}\n              top={top}\n              currentUserId={currentUserId}\n            />}\n          />}\n        <NonAnnotationColumn \n          currentTrack={currentTrack}\n          hide={hideNonAnnotation}\n        />\n      </div>\n    );\n  }\n};\n\nexport default InfoColumn;","import { connect } from 'react-redux';\nimport InfoColumn from './info_column';\nimport { withRouter } from 'react-router-dom';\nimport { receiveAnnotation, removeAnnotation, createAnnotation, deleteAnnotation } from '../../../actions/annotation_actions';\n\nconst mapStateToProps = (state, ownProps) => ({\n  annotations: state.entities.annotations,\n  currentUserId: state.session.id,\n  currentTrack: state.entities.tracks[ownProps.match.params.trackId]\n});\n\nconst mapDispatchToProps = dispatch => ({\n  createTempAnnotation: annotation => dispatch(receiveAnnotation(annotation)),\n  removeAnnotation: id => dispatch(removeAnnotation(id)),\n  createAnnotation: annotation => dispatch(createAnnotation(annotation)),\n  deleteAnnotation: id => dispatch(deleteAnnotation(id))\n});\n\nexport default withRouter(connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(InfoColumn));","import React from 'react';\nimport QuestionSection from '../questions/section';\n\nconst NonAnnotationColumn = props => {\n  const { currentTrack, hide } = props;\n  let youtube_url;\n  if (currentTrack)  {\n    youtube_url = currentTrack.youtube_url;\n  }\n\n  let youtubeUrl;\n  if (youtube_url !== undefined && youtube_url !== '' && youtube_url !== null) {\n    const regExp = /^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|\\&v=|\\?v=)([^#\\&\\?]*).*/;\n    const match = youtube_url.match(regExp);\n    if (match && match[2].length == 11) {\n      youtubeUrl = 'https://www.youtube.com/embed/' + match[2];\n    }\n    else {\n      youtubeUrl = undefined;\n    }\n  }\n  // https://stackoverflow.com/questions/28735459/how-to-validate-youtube-url-in-client-side-in-text-box\n\n  return (\n    <div \n      className=\"info-column-non-annotation\"\n      style={{ display: hide ? \"none\" : \"block\" }}>\n      { youtubeUrl &&\n        <div className=\"video\">\n          <h3>Video</h3>\n          <iframe\n            src={`${youtubeUrl}`}\n            frameBorder=\"0\"\n            samesite=\"none\"\n          />\n        </div>\n      }\n      <QuestionSection />\n    </div>\n  )\n};\n\nexport default NonAnnotationColumn;","import React from 'react';\nimport * as AnnotateUtil from '../../util/annotate_util';\nimport InfoColumnContainer from './second_column/info_column_container';\nimport CommentColumn from './comments/column';\nimport FadeIn from 'react-fade-in';\nimport ReactLoading from \"react-loading\";\nimport { Link } from 'react-router-dom';\nimport TrackArtistLink from './artist_link';\nimport defaultImage from 'assets/images/no_image.png';\n\nfunction handleImageError() {\n  this.src = 'https://upload.wikimedia.org/wikipedia/commons/a/ac/No_image_available.svg';\n};\n\nclass TrackShow extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = { \n      done: false, \n      top: 0, \n      annotationPrompt: false, \n      editLyrics: false, \n      lyrics: \"\", \n      startIdx: undefined, \n      endIdx: undefined,\n    }\n    this.editButton = this.editButton.bind(this);\n    this.submitLyrics = this.submitLyrics.bind(this);\n    this.handleHighlight = this.handleHighlight.bind(this);\n    this.handleSpanClick = this.handleSpanClick.bind(this);\n    this.closeAnnotationPrompt = this.closeAnnotationPrompt.bind(this);\n    this.handleModal = this.handleModal.bind(this);\n  }\n\n  componentDidMount() {\n    this.clearInfo()\n    document.addEventListener(\"mousedown\", this.closeAnnotationPrompt);\n    this.props.fetchTrack(this.props.match.params.trackId)\n      .then(res => {\n        this.setState({ done: true, lyrics: res.track.lyrics });\n        if (res.track.album_id) {\n          this.props.fetchAlbum(res.track.album_id);\n        };\n      }, err => this.setState({ done: true }));\n    //document.addEventListener(\"click\", this.handleSpanClick);\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.props.match.params.trackId !== prevProps.match.params.trackId) {\n      this.clearInfo()\n      this.setState({ done: false });\n      this.props.fetchTrack(this.props.match.params.trackId)\n        .then(res => {\n          this.setState({ done: true, lyrics: res.track.lyrics });\n          if (res.track.album_id) {\n            this.props.fetchAlbum(res.track.album_id);\n          };\n        }, err => this.setState({ done: true }));\n    }\n  }\n\n  componentWillUnmount() {\n    this.clearInfo()\n    document.removeEventListener(\"mousedown\", this.closeAnnotationPrompt);\n  }\n\n  clearInfo() {\n    this.props.clearTracks();\n    this.props.clearArtists();\n    this.props.clearAlbums();\n    this.props.clearAnnotations();\n    this.props.clearUpvotes();\n    this.props.clearComments();\n  }\n\n  editButton() {\n    this.setState({ annotationPrompt: false });\n    const editLyrics = !this.state.editLyrics;\n    this.setState({ editLyrics });\n  }\n\n  showAnnotationPrompt(startIdx, endIdx) {\n    if (startIdx === endIdx) { \n      this.setState({ annotationPrompt: false }) \n    } else {\n      this.setState( { annotationPrompt: true } )\n    }\n  }\n\n  closeAnnotationPrompt(e) {\n    if (e) {\n      if (e.target.id === \"annotation-prompt-button\") {\n        return;\n      } else {\n        this.setState({ annotationPrompt: false });\n      }\n    } else {\n      this.setState({ annotationPrompt: false });\n    }\n  }\n\n  handleSpanClick(e) {\n    if (e.target.className.match(/annotation-submit/)) { return }\n    if (e.target.localName === \"button\" || e.target.localName === \"a\") { return };\n    \n    if (e.target.className === \"annotated-lyrics\") { \n      this.props.history.push(`/tracks/${this.props.currentTrack.id}/${e.target.id}`);\n    } else if (e.target.className.match(/annotation-show$/)) {\n      return;\n    } else {\n      let x = e.target;\n      while (x = x.parentNode) {\n        if (!x) {\n          break;\n        } else if (x.className && x.className.match(/annotation-show$/)) {\n          return;\n        }\n      }\n      this.props.history.push(`/tracks/${this.props.currentTrack.id}`);\n    }\n  }\n\n  handleHighlight() {\n    if (this.state.editLyrics) return; // don't need to handle highlights when editing lyrics\n    const selection = window.getSelection();\n    if (!selection.extentNode || !selection.baseNode) return; // end and start nodes must exist\n\n    const annotationNodes = document.getElementsByClassName('annotated-lyrics');\n    if (AnnotateUtil.annotationsNotSelected(annotationNodes)) {\n      const lyricsContainer = document.getElementById(\"lyrics-container\");\n      const firstColumn = document.getElementById(\"track-show-column-first\");\n      const { i1, i2, j1, j2 } = AnnotateUtil.getIndices(lyricsContainer); \n      // I could've deconstructed for these methods, but I wanted them to be easy to remember for the future!\n      const mappedNodeList = AnnotateUtil.mapNodeList(lyricsContainer.childNodes);\n      const { startIdx, endIdx } = AnnotateUtil.getStartAndEndIndices(mappedNodeList, { i1, i2, j1, j2 });\n      const top1 = firstColumn.getBoundingClientRect().top;\n      const top2 = selection.getRangeAt(0).getBoundingClientRect().top;\n      // const top = selection.getRangeAt(0).getBoundingClientRect().top + window.scrollY - 354;\n      const top = top2 - top1 - 10;\n      this.setState({ startIdx, endIdx, top });\n      this.showAnnotationPrompt(startIdx, endIdx);\n    };\n  }\n\n  handleModal() {\n    this.props.openModal('trackEdit');\n  }\n\n  handleImageError() {\n    this.src = defaultImage;\n  };\n\n  submitLyrics() {\n    const track = { id: this.props.currentTrack.id, lyrics: this.state.lyrics }\n\n    this.props.updateTrack(track)\n      .then(() => this.editButton());\n  }\n\n  update(field) {\n    return e => {\n      this.setState({ [field]: e.target.value });\n    }\n  }\n\n  render() {\n    if (!this.state.done) { \n      return <ReactLoading type={\"bars\"} color={\"white\"} />;\n    } else if (this.props.currentTrack === undefined || this.props.currentTrack.lyrics === undefined) { \n      return <div className=\"no-tracks-shown\"><h2>Error!</h2><p>The song you are looking for does not exist!</p></div>\n    };\n\n    const { currentTrack, loggedIn } = this.props;\n    const lyricsLines = currentTrack.lyrics.split(/\\r?\\n/).reduce((acc, val, i) => acc.concat(val, <br key={i} />), []).length - 1;\n    \n    // we have to order the annotations since they are ordered by id, not start_idx right now\n    // we want annotations in REVERSE ORDER!\n\n    let lyricsHTML\n    if (this.props.annotations !== undefined) {\n      const annotations = Object.values(this.props.annotations).sort((a, b) => b.start_idx - a.start_idx);\n      const annotatedLyrics = AnnotateUtil.annotateLyrics(currentTrack.lyrics, annotations);\n      lyricsHTML = AnnotateUtil.lineBreakLyrics(annotatedLyrics);\n    } else {\n      lyricsHTML = AnnotateUtil.lineBreakLyrics(currentTrack.lyrics);\n    }\n    \n    const lyricsContainer = (<p dangerouslySetInnerHTML={{ __html: lyricsHTML }} id='lyrics-container'></p>)\n\n    const editArea = (< textarea onChange={this.update(\"lyrics\")} style={{minHeight: \"150px\", height: lyricsLines * 17}} id = \"edit-textarea\" rows = \"10\" value = { this.state.lyrics } />);\n    const lyricsButtons = loggedIn ? \n      (!this.state.editLyrics ?\n        <div>\n          <button onClick={this.editButton}>Edit Lyrics</button>\n          <button onClick={this.handleModal}>Edit Song Facts</button>\n        </div> :\n        <div>\n          <button id=\"lyrics-edit-save-button\" onClick={this.submitLyrics}>Save</button>\n          <button onClick={this.editButton}>Cancel</button>\n        </div>\n      ) : <div />\n    \n    const { features, producers, writers, album, name, artist, image_url } = this.props.currentTrack;\n    const featureLinks = features.map((feature, i) => (\n      <span key={ feature.id }>\n        { i === 0 && ' ' }\n        { (i > 0 && features.length > 2) && ', ' }\n        { (i > 0 && features.length === 2) && ' & '}\n        <TrackArtistLink artist={ feature } />\n      </span>\n    ));\n\n    const producerLinks = producers.map((producer, i) => (\n      <span key={ producer.id }>\n        { i === 0 && ' ' }\n        { (i > 0 && producers.length > 2) && ', ' }\n        { (i > 0 && producers.length === 2) && ' & ' }\n        <TrackArtistLink artist={ producer } key={ producer.id } />\n      </span>\n    ));\n\n    const writerLinks = writers.map((writer, i) => (\n      <span key={writer.id}>\n        {i === 0 && ' '}\n        {(i > 0 && writers.length > 2) && ', '}\n        {(i > 0 && writers.length === 2) && ' & '}\n        <TrackArtistLink artist={writer} key={writer.id} />\n      </span>\n    ));\n\n    const heroStyle = {\n      backgroundImage: image_url ? `url(${image_url})` : \"\"\n    };\n\n    return (\n      <section className=\"track-show-page\" onClick={this.handleSpanClick}>\n        <FadeIn>\n          <header className=\"track-show-header\" id=\"track-show-hero-image\" style={heroStyle}>\n            <div className=\"track-show-header-center\">\n              <div className=\"track-show-image-container\">\n                <div className=\"content\">\n                  <img onError={handleImageError.bind(this)} src={ image_url || defaultImage } />\n                </div>\n              </div>\n              <div className=\"track-show-header-info-container\">\n                <h1>{ name }</h1>\n                <h2><TrackArtistLink artist={artist}/></h2>\n                <div className=\"track-show-header-additional\">\n                  { features.length > 0 && \n                    <h3>Featuring\n                      { featureLinks }\n                    </h3> }\n                  { producers.length > 0 && \n                    <h3>Produced by\n                      <span>\n                        { producerLinks }\n                      </span>\n                    </h3> }\n                  { writers.length > 0 && \n                    <h3>Written by\n                      <span>\n                        { writerLinks }\n                      </span>\n                    </h3> }\n                  { album && <h3>Album <span><Link to={`/albums/${album.id}`}>{album.title}</Link></span></h3> }\n                </div>\n              </div>\n            </div>\n          </header>\n        </FadeIn>\n        <main className=\"track-show-main\">\n          <div id=\"track-show-column-first\" className=\"track-show-column-first\" onMouseUp={this.handleHighlight}>\n            <section id=\"lyrics-rect\" className=\"track-show-lyrics-container\">\n              { lyricsButtons }\n              { !this.state.editLyrics ? \n                lyricsContainer : \n                editArea \n              }\n            </section>\n            <CommentColumn currentTrack={this.props.currentTrack} />\n          </div>\n          <div className=\"track-show-column-second\" id=\"second-col\">\n            <InfoColumnContainer\n              closeAnnotationPrompt={this.closeAnnotationPrompt}\n              annotationPrompt={this.state.annotationPrompt}\n              startIdx={this.state.startIdx}\n              endIdx={this.state.endIdx}\n              currentTrack={this.props.currentTrack}\n              top={this.state.top} /> \n          </div>\n        </main>\n        <footer className=\"track-show-footer\">\n        </footer>\n      </section>\n    )\n  }\n}\n\nexport default TrackShow;","import { connect } from 'react-redux'\nimport { withRouter } from 'react-router-dom';\nimport TrackShow from './track_show';\nimport { fetchAlbum, clearAlbums } from '../../actions/album_actions';\nimport { fetchTrack, clearTracks, updateTrack } from '../../actions/track_actions';\nimport { clearArtists } from '../../actions/artist_actions';\nimport { clearUpvotes } from '../../actions/upvote_actions';\nimport { receiveAnnotation, clearAnnotations } from '../../actions/annotation_actions';\nimport { clearComments } from '../../actions/comment_actions';\nimport { openModal } from '../../actions/modal_actions';\n\nconst mapStateToProps = (state, ownProps) => ({\n  currentTrack: state.entities.tracks[ownProps.match.params.trackId],\n  loggedIn: Boolean(state.session.id),\n  annotations: state.entities.annotations\n});\n\nconst mapDispatchToProps = dispatch => ({\n  fetchAlbum: id => dispatch(fetchAlbum(id)),\n  fetchTrack: id => dispatch(fetchTrack(id)),\n  clearTracks: () => dispatch(clearTracks()),\n  clearArtists: () => dispatch(clearArtists()),\n  clearAlbums: () => dispatch(clearAlbums()),\n  clearAnnotations: () => dispatch(clearAnnotations()),\n  clearUpvotes: () => dispatch(clearUpvotes()),\n  clearComments: () => dispatch(clearComments()),\n  updateTrack: track => dispatch(updateTrack(track)),\n  createTempAnnotation: annotation => dispatch(receiveAnnotation(annotation)),\n  openModal: modal => dispatch(openModal(modal))\n});\n\nexport default withRouter(connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(TrackShow));","export const annotationsNotSelected = (annotationNodes) => {\n  return !Object.values(annotationNodes)\n    .some(node => window.getSelection().containsNode(node, true))\n}\n\nexport const annotateLyrics = (lyrics, annotations) => {\n  let annotated = lyrics.split(\"\");\n  annotations.forEach(annotation => {\n    annotated.splice(annotation.end_idx, 0, \"</span>\")\n    annotated.splice(annotation.start_idx, 0, `<span class='annotated-lyrics' id=${annotation.id}>`)\n  })\n\n  return annotated.join(\"\");\n};\n\nexport const lineBreakLyrics = lyricsStr => {\n  return lyricsStr.split(/\\n/).join('<br>');\n};\n\nexport const mapNodeList = nodeList => {\n  return Array.from(nodeList).map(node => {\n    if (node.nodeName === \"BR\") {\n      return '\\n';\n    } else if (node.nodeName === \"SPAN\") {\n      return node.innerText;\n    } else if (node.nodeName === \"#text\") {\n      return node.nodeValue;\n    }\n  });\n};\n\nexport const getIndices = (container) => {\n  const selection = window.getSelection();\n  const { baseNode, extentNode } = window.getSelection();\n  let i1, i2, j1, j2;\n\n  if (!container) { return { i1: 0, i2: 0, j1: 0, j2: 0 } }\n  if (!baseNode) { return { i1: 0, i2: 0, j1: 0, j2: 0 } }\n  if (!extentNode) { return { i1: 0, i2: 0, j1: 0, j2: 0 } }\n  \n  i1 = Array.prototype.indexOf.call(container.childNodes, selection.baseNode);\n  i2 = Array.prototype.indexOf.call(container.childNodes, selection.extentNode);\n  j1 = selection.baseOffset;\n  j2 = selection.extentOffset;\n  if (baseNode.parentElement.id !== 'lyrics-container' && extentNode.parentElement.id !== 'lyrics-container') {\n    [i1, i2, j1, j2] = [0, 0, 0, 0];\n  } else if (baseNode.parentElement.id !== 'lyrics-container') {\n    i1 = selection.baseOffset + 1;\n    j1 = 0;\n  } else if (extentNode.parentElement.id !== 'lyrics-container') {\n    if (selection.extentOffset < i1) {\n      i2 = selection.extentOffset + 1;\n      j2 = 0\n    } else {\n      i2 = selection.extentOffset - 2;\n      if (container.childNodes[i2].nodeValue !== null) {\n        j2 = container.childNodes[i2].nodeValue.length;\n      } else {\n        j2 = 0;\n      }\n    }\n  }\n  return { i1, i2, j1, j2 };\n}\n\nexport const getStartAndEndIndices = (mappedNodeList, indices) => {\n  const { i1, i2, j1, j2 } = indices;\n  const prevOne = mappedNodeList.map(mappedNode => mappedNode.length).slice(0, i1).reduce((a, b) => a + b, 0);\n  const prevTwo = mappedNodeList.map(mappedNode => mappedNode.length).slice(0, i2).reduce((a, b) => a + b, 0);\n  const oneIndex = prevOne + j1;\n  const twoIndex = prevTwo + j2;\n  return { startIdx: Math.min(oneIndex, twoIndex) , endIdx: Math.max(oneIndex, twoIndex) };\n};\n\nexport const displayHeightStyle = (annotationId, top) => {\n  const lyricsContainer = document.getElementById(\"lyrics-rect\");\n  const span = document.getElementById(annotationId);\n\n  // \"top\" comes from when the form is made, but is not ideal for the display\n  // since the user might scroll in between submitting the form and looking at\n  // the annotation-show\n\n  let style\n  if (span) {\n    const top1 = lyricsContainer.getBoundingClientRect().top;\n    const top2 = span.getBoundingClientRect().top;\n    style = { marginTop: `${Math.max(top2 - top1, 0)}px` };\n    // It'll probably never be 0px on the current page setup, but just in case...\n  } else {\n    style = { marginTop: `${top}px` };\n  }\n\n  return style;\n};","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { TwitterTweetEmbed } from 'react-twitter-embed';\n\nconst tweetRegex = /\\[https?:\\/\\/twitter\\.com\\/(?:#!\\/)?(\\w+)\\/status\\/(\\d+)\\]$/g;\n\nexport const replaceTweets = str => {\n  return str.replace(tweetRegex, \n    \"\\n<tweet id=$2 />\"\n  );\n};\n\nexport const renderTweets = () => {\n  const tweets = document.querySelectorAll(\"tweet\");\n  tweets.forEach(tweet => {\n    ReactDOM.render(<TwitterTweetEmbed tweetId={tweet.id} />, tweet);\n  })\n};","export const commentUpvotes = (upvotes, commentId) => {\n  return upvotes.filter(upvote => (\n    upvote.upvotable_type === \"Comment\" && upvote.upvotable_id === commentId))\n};\n\nexport const annotationUpvotes = (upvotes, annotationId) => {\n  return upvotes.filter(upvote => (\n    upvote.upvotable_type === \"Annotation\" && upvote.upvotable_id === annotationId))\n};\n\nexport const answerUpvotes = (upvotes, answerId) => {\n  return upvotes.filter(upvote => (\n    upvote.upvotable_type === \"Answer\" && upvote.upvotable_id === answerId))\n};\n\nexport const determineSign = upvoteCount => {\n  let sign;\n  if (upvoteCount > 0) {\n    sign = \"+\";\n  } else if (upvoteCount < 0) {\n    sign = \"\";\n  } else {\n    sign = \" \";\n  }\n  return sign;\n};\n\nexport const count = upvotes => {\n  return upvotes.reduce((acc, upvote) => acc + upvote.value, 0);\n};\n\nconst isUpvotedByUser = (upvotes, currentUser) => {\n  return upvotes.some(upvote => currentUser && upvote.user_id === currentUser.id);\n};\n\nexport const currentUpvote = (upvotes, currentUser) => {\n  const isUpvoted = isUpvotedByUser(upvotes, currentUser);\n  if (!isUpvoted) { return undefined };\n  return upvotes.find(upvote => upvote.user_id === currentUser.id);\n};\n\nexport const determineCallbacks = (currentUpvote, currentUser, up, down, erase, reverse) => {\n  let leftCb, rightCb;\n  if (currentUpvote) {\n    [leftCb, rightCb] = currentUpvote.value === 1 ? \n      [erase, reverse] : [reverse, erase];\n  } else if (currentUser) {\n    [leftCb, rightCb] = [up, down];\n  } else {\n    [leftCb, rightCb] = [() => {}, () => {}];\n  }\n  return [leftCb, rightCb];\n};\n\nexport const determineClasses = (currentUpvote) => {\n  let leftClass, rightClass;\n  if (currentUpvote) {\n    [leftClass, rightClass] = currentUpvote.value === 1 ?\n      [\"green-up\", \"\"] : [\"\", \"red-down\"];\n  } else {\n    [leftClass, rightClass] = [\"\", \"\"];\n  }\n  return [leftClass, rightClass];\n};"],"sourceRoot":""}